# Traefik global configuration
#-https://doc.traefik.io/traefik/contributing/data-collection/
global:
  checkNewVersion: true
  sendAnonymousUsage: true
# Enable traefik ui dashboard
#-https://doc.traefik.io/traefik/operations/api/
api:
  dashboard: true
  insecure: false   # access to http://traefikIP:8080/dashboard/ is disabled
  debug: true
  disableDashboardAd: true
entryPoints:
  web:
    address: ":80"
    http:
    #  redirections: #https://doc.traefik.io/traefik/routing/entrypoints/#redirection
          entryPoint:
              to: websecure
              scheme: https
  websecure:
    address: ":443"
  metrics:
    address: :8082
#https://doc.traefik.io/traefik/observability/metrics/prometheus/
metrics:
  prometheus:
    entryPoint: metrics
# https://doc.traefik.io/traefik/routing/services/#serverstransport_1
# https://www.cloudflare.com/en-gb/learning/ssl/what-is-sni/
serversTransport:
    insecureSkipVerify: true
#-https://doc.traefik.io/traefik/providers/overview/
providers:
#-https://doc.traefik.io/traefik/providers/file/
  file:
    directory: /etc/traefik/dynamic
    watch: true
    #filename: /etc/traefik/config.yml # when a specific file is desired
#-https://doc.traefik.io/traefik/https/acme/
certificatesResolvers:
  cloudflare:
    acme:
      caServer: https://acme-v02.api.letsencrypt.org/directory         # prod #https://letsencrypt.org/docs/rate-limits/
      # caServer: https://acme-staging-v02.api.letsencrypt.org/directory # test
      email: email@gmail.com # valid Cloudflare-account email
      storage: /etc/traefik/acme.json
      dnsChallenge:
        provider: cloudflare
        #disablePropagationCheck: true # uncomment this if you have issues pulling certificates through cloudflare, By setting this flag to true disables the need to wait for the propagation of the TXT record to all authoritative name servers.
        resolvers:
          - "1.1.1.1:53"
          - "1.0.0.1:53"

log: #- https://doc.traefik.io/traefik/observability/logs/
    level: "INFO"
    filePath: "/var/log/traefik/traefik.log"
    noColor: false # Recommended to be true when using common. When using the 'common' format, disables the colorized output
    maxSize: 100 # In megabytes. Maximum size in megabytes of the log file before it gets rotated.
    compress: true # gzip compression when rotating. Determines if the rotated log files should be compressed using gzip.
#
#-https://doc.traefik.io/traefik/observability/access-logs/
accessLog:
    addInternals: true #Enables access logs for internal resources (e.g.: ping@internal)
    filePath: "/var/log/traefik/access.log"
    bufferingSize: 100 # number of log lines Traefik will keep in memory before writing them to the selected output
    fields:
        names:
            StartUTC: drop # Write logs in Container Local Time instead of UTC. The time at which request processing started. The time at which request processing started.
    filters:
        statusCodes:
            - "204-299"
            - "400-599"
#
experimental:
    plugins:
        bouncer:
            moduleName: "github.com/maxlerebourg/crowdsec-bouncer-traefik-plugin"
            version: "v1.4.4"
        #
        cloudflarewarp:
            modulename: github.com/BetterCorp/cloudflarewarp
            version: v1.3.3